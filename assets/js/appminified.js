const token="655d9216-acc1-4fe5-bf5d-6f424b0d62c6",baseUrl="https://open.faceit.com/data/v4/";let player_Nick_1,player_Nick_2,player_id_1,playerData,urlsplit,playerUrl,output=$("#Profiles"),timesMet=0,timesInTeam=0,timesInEnemy=0,searchOffset=0,matchOutTimer=0;$(function(){$("#searchButton").click(function(e){if(clearVals(),player_Nick_1=""!=$("#input1").val())if(clearHtml(),player_Nick_2=""!=$("#input2").val())if(clearHtml(),$("#friendlyTeam").empty().append("Friendly:<br>"),$("#enemyTeam").empty().append("Enemy:<br>"),matches_Amount=""!=$("#input3").val()){player_Nick_1=$("#input1").val(),player_Nick_2=$("#input2").val(),matches_Amount=$("#input3").val(),clearHtml(),setTimers(),handlePlayerNickToId1(player_Nick_1),handlePlayerNickToId2(player_Nick_2),setTimeout(function(){setParagraph()},6e3);let e=setInterval(()=>timedEvents(),100);setTimeout(()=>{clearInterval(e)},matches_Amount)}else output.empty().append("Please fill in the amount of matches");else output.empty().append("Please fill in player 2");else output.empty().append("Please fill in player 1");e.preventDefault()})});let calcSearch=()=>{for(calcAmount=matches_Amount-100;searchOffset!=calcAmount;)return searchOffset=parseFloat(searchOffset+100);return searchOffset},timedEvents=()=>{setTimeout(function(){console.log(searchOffset)},1602),setTimeout(function(){getAllPlayerMatches(player_id_1,searchOffset)},1e3)},setParagraph=()=>{$("#textOutput").append(`<p><strong>${player_Nick_1}</strong> has met <strong>${player_Nick_2}</strong> <strong>${timesMet}</strong> times in ${matches_Amount} matches.</p>\n    <p><strong>${player_Nick_1}</strong> and <strong>${player_Nick_2}</strong> where teammates in <strong>${timesInTeam}</strong> games and enemies in <strong>${timesInEnemy}</strong> games.</p>`)},setTimers=()=>{timesMet=0,timesInEnemy=0,timesInTeam=0,searchOffset=0},clearHtml=()=>{output.empty(),$("#listMatches").empty(),$("#textOutput").empty()},clearVals=()=>{player_Nick_1="",player_Nick_2=""},handlePlayerNickToId1=e=>{let a=`${baseUrl}players?nickname=${e}`;$.ajax({headers:{Authorization:"Bearer "+token},url:a,dataType:"json",error:handleAjaxError}).done(function(a){player_id_1=a.player_id,avatar_1=a.avatar,steamid_1=a.platforms.steam,country_1=a.country,faceit_elo_1=a.games.csgo.faceit_elo,steam_id_64_1=a.steam_id_64,faceit_url=a.faceit_url,profileLink_1=faceit_url.split("/").slice(-1)[0],output.append(`<div class='profileBox'>\n    <img src='${avatar_1}'>\n    <div class='profileInfo'>\n    <h3><a href='https://www.faceit.com/en/players/${profileLink_1}'>${e}</a></h3>\n    <pre>Elo:${faceit_elo_1}</pre>\n    <pre>Country:${country_1}</pre>\n    <pre>Faceit-id:<strong>${player_id_1}</strong></pre>\n    <pre>Steam-id:${steamid_1}</pre>\n    <pre><a href='https://steamcommunity.com/profiles/${steam_id_64_1}'>Steam-profile</a></pre>\n     </div>\n     </div>`)})},handlePlayerNickToId2=e=>{let a=`${baseUrl}players?nickname=${e}`;$.ajax({headers:{Authorization:"Bearer "+token},url:a,dataType:"json",error:handleAjaxError}).done(function(a){player_id_2=a.player_id,avatar_2=a.avatar,steamid_2=a.platforms.steam,country_2=a.country,faceit_elo_2=a.games.csgo.faceit_elo,steam_id_64_2=a.steam_id_64,faceit_url=a.faceit_url,profileLink_2=faceit_url.split("/").slice(-1)[0],output.append(`<div class='profileBox'>\n    <img src='${avatar_2}'>\n    <div class='profileInfo'>\n    <h3><a href='https://www.faceit.com/en/players/${profileLink_2}'>${e}</a></h3>\n    <pre>Elo:${faceit_elo_2}</pre>\n    <pre>Country:${country_2}</pre>\n    <pre>Faceit-id:<strong>${player_id_2}</strong></pre>\n    <pre>Steam-id:${steamid_2}</pre>\n    <pre><a href='https://steamcommunity.com/profiles/${steam_id_64_2}'>Steam-profile</a></pre>\n     </div>\n     </div>`)})},handlePlayerId=e=>{let a=`${baseUrl}players/${e}`;$.ajax({headers:{Authorization:"Bearer "+token},url:a,dataType:"json",error:handleAjaxError}).done(function(e){output.append(`${e.nickname}<br>`)})},getAllPlayerMatches=(e,a)=>{a=calcSearch()-100;let t=`${baseUrl}players/${e}/history?game=csgo&from=1262304000&to=1555493746&offset=${a}&limit=100`;console.log(t),$.ajax({headers:{Authorization:"Bearer "+token},url:t,dataType:"json",error:handleAjaxError}).done(function(e){console.log(e);for(let a=0;a<e.items.length;a++)matches=e.items[a],players=matches.playing_players,posiOne=players.indexOf(player_id_1),posiTwo=players.indexOf(player_id_2),-1!=posiTwo&&(getIfTeamOrEnemy(0,4),getIfTeamOrEnemy(5,9))})},getIfTeamOrEnemy=(e,a)=>{posiOne>=e&&posiOne<=a&&(timesMet++,posiTwo>=e&&posiTwo<=a?(timesInTeam++,convertUrl(matches.faceit_url),getAllPlayerMatchesStats(urlsplit,"Friendly")):(timesInEnemy++,convertUrl(matches.faceit_url),getAllPlayerMatchesStats(urlsplit,"Enemy")))},getAllPlayerMatchesStats=(e,a)=>{let t=`${baseUrl}matches/${e}/stats`;$.ajax({headers:{Authorization:"Bearer "+token},url:t,dataType:"json",error:handleAjaxError}).done(function(t){mapPlayed=t.rounds[0].round_stats.Map,scoreLine=t.rounds[0].round_stats.Score,scoreCheck=scoreLine.substring(0,2),"Friendly"==a&&$("#friendlyTeam").append(`<li class='matchButton${a}'><a href='https://www.faceit.com/en/csgo/room/${e}/scoreboard'>${mapPlayed} - <span class='span'>${scoreLine}</span></a></li>`),"Enemy"==a&&$("#enemyTeam").append(`<li class='matchButton${a}'><a href='https://www.faceit.com/en/csgo/room/${e}/scoreboard'>${mapPlayed} - <span class='span'>${scoreLine}</span></a></li>`)})},convertUrl=e=>(url=e,urlsplit=url.split("/").slice(-1)[0]),handleAjaxError=()=>{console.log("There was a problem proccesing your request")};